<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Model Building &amp; Scoring for Prediction | Statistical Foundations</title>
  <meta name="description" content="Chapter 6 Model Building &amp; Scoring for Prediction | Statistical Foundations" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Model Building &amp; Scoring for Prediction | Statistical Foundations" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="IAA-Faculty/statistical_foundations" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Model Building &amp; Scoring for Prediction | Statistical Foundations" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="diag.html"/>
<link rel="next" href="cat.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a style="font-weight:bold, text-align:center" href="https://github.com/IAA-Faculty/statistical_foundations/">Statistical Foundations</a>
<img src="./img/iaaicon.png" alt="IAA"  class="center"</li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#authors"><i class="fa fa-check"></i>Authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#structure-of-the-book"><i class="fa fa-check"></i>Structure of the book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro-stat.html"><a href="intro-stat.html"><i class="fa fa-check"></i><b>1</b> Introduction to Statistics</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro-stat.html"><a href="intro-stat.html#eda"><i class="fa fa-check"></i><b>1.1</b> Exploratory Data Analysis (EDA)</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="intro-stat.html"><a href="intro-stat.html#vartypes"><i class="fa fa-check"></i><b>1.1.1</b> Types of Variables</a></li>
<li class="chapter" data-level="1.1.2" data-path="intro-stat.html"><a href="intro-stat.html#dist"><i class="fa fa-check"></i><b>1.1.2</b> Distributions</a></li>
<li class="chapter" data-level="1.1.3" data-path="intro-stat.html"><a href="intro-stat.html#normal"><i class="fa fa-check"></i><b>1.1.3</b> The Normal Distribution</a></li>
<li class="chapter" data-level="1.1.4" data-path="intro-stat.html"><a href="intro-stat.html#skew"><i class="fa fa-check"></i><b>1.1.4</b> Skewness</a></li>
<li class="chapter" data-level="1.1.5" data-path="intro-stat.html"><a href="intro-stat.html#kurt"><i class="fa fa-check"></i><b>1.1.5</b> Kurtosis</a></li>
<li class="chapter" data-level="1.1.6" data-path="intro-stat.html"><a href="intro-stat.html#graphdist"><i class="fa fa-check"></i><b>1.1.6</b> Graphical Displays of Distributions</a></li>
<li class="chapter" data-level="1.1.7" data-path="intro-stat.html"><a href="intro-stat.html#python-code"><i class="fa fa-check"></i><b>1.1.7</b> Python Code</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="intro-stat.html"><a href="intro-stat.html#pointest"><i class="fa fa-check"></i><b>1.2</b> Point Estimates</a></li>
<li class="chapter" data-level="1.3" data-path="intro-stat.html"><a href="intro-stat.html#ci"><i class="fa fa-check"></i><b>1.3</b> Confidence Intervals</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="intro-stat.html"><a href="intro-stat.html#python-code-1"><i class="fa fa-check"></i><b>1.3.1</b> Python Code</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="intro-stat.html"><a href="intro-stat.html#hypotest"><i class="fa fa-check"></i><b>1.4</b> Hypothesis Testing</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="intro-stat.html"><a href="intro-stat.html#onesample"><i class="fa fa-check"></i><b>1.4.1</b> One-Sample T-Test</a></li>
<li class="chapter" data-level="1.4.2" data-path="intro-stat.html"><a href="intro-stat.html#python-code-2"><i class="fa fa-check"></i><b>1.4.2</b> Python Code</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="intro-stat.html"><a href="intro-stat.html#two-sample-t-tests"><i class="fa fa-check"></i><b>1.5</b> Two-Sample t-tests</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="intro-stat.html"><a href="intro-stat.html#testnorm"><i class="fa fa-check"></i><b>1.5.1</b> Testing Normality of Groups</a></li>
<li class="chapter" data-level="1.5.2" data-path="intro-stat.html"><a href="intro-stat.html#ftest"><i class="fa fa-check"></i><b>1.5.2</b> Testing Equality of Variances</a></li>
<li class="chapter" data-level="1.5.3" data-path="intro-stat.html"><a href="intro-stat.html#tsttest"><i class="fa fa-check"></i><b>1.5.3</b> Testing Equality of Means</a></li>
<li class="chapter" data-level="1.5.4" data-path="intro-stat.html"><a href="intro-stat.html#python-code-3"><i class="fa fa-check"></i><b>1.5.4</b> Python Code</a></li>
<li class="chapter" data-level="1.5.5" data-path="intro-stat.html"><a href="intro-stat.html#wilcoxon"><i class="fa fa-check"></i><b>1.5.5</b> Mann-Whitney-Wilcoxon Test</a></li>
<li class="chapter" data-level="1.5.6" data-path="intro-stat.html"><a href="intro-stat.html#python-code-4"><i class="fa fa-check"></i><b>1.5.6</b> Python Code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="slr.html"><a href="slr.html"><i class="fa fa-check"></i><b>2</b> Introduction to ANOVA and Linear Regression</a>
<ul>
<li class="chapter" data-level="2.1" data-path="slr.html"><a href="slr.html#evp"><i class="fa fa-check"></i><b>2.1</b> Predictive vs. Explanatory</a></li>
<li class="chapter" data-level="2.2" data-path="slr.html"><a href="slr.html#trainvalidtest"><i class="fa fa-check"></i><b>2.2</b> Honest Assessment</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="slr.html"><a href="slr.html#python-code-5"><i class="fa fa-check"></i><b>2.2.1</b> Python Code</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="slr.html"><a href="slr.html#bivariate-eda"><i class="fa fa-check"></i><b>2.3</b> Bivariate EDA</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="slr.html"><a href="slr.html#continuous-continuous-associations"><i class="fa fa-check"></i><b>2.3.1</b> Continuous-Continuous Associations</a></li>
<li class="chapter" data-level="2.3.2" data-path="slr.html"><a href="slr.html#continuous-categorical-associations"><i class="fa fa-check"></i><b>2.3.2</b> Continuous-Categorical Associations</a></li>
<li class="chapter" data-level="2.3.3" data-path="slr.html"><a href="slr.html#python-code-6"><i class="fa fa-check"></i><b>2.3.3</b> Python Code</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="slr.html"><a href="slr.html#oneway"><i class="fa fa-check"></i><b>2.4</b> One-Way ANOVA</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="slr.html"><a href="slr.html#python-code-7"><i class="fa fa-check"></i><b>2.4.1</b> Python Code</a></li>
<li class="chapter" data-level="2.4.2" data-path="slr.html"><a href="slr.html#testing-assumptions"><i class="fa fa-check"></i><b>2.4.2</b> Testing Assumptions</a></li>
<li class="chapter" data-level="2.4.3" data-path="slr.html"><a href="slr.html#python-code-8"><i class="fa fa-check"></i><b>2.4.3</b> Python Code</a></li>
<li class="chapter" data-level="2.4.4" data-path="slr.html"><a href="slr.html#kruskal"><i class="fa fa-check"></i><b>2.4.4</b> Kruskal-Wallis</a></li>
<li class="chapter" data-level="2.4.5" data-path="slr.html"><a href="slr.html#python-code-9"><i class="fa fa-check"></i><b>2.4.5</b> Python Code</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="slr.html"><a href="slr.html#posthoc"><i class="fa fa-check"></i><b>2.5</b> ANOVA Post-hoc Testing</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="slr.html"><a href="slr.html#tukey"><i class="fa fa-check"></i><b>2.5.1</b> Tukey-Kramer</a></li>
<li class="chapter" data-level="2.5.2" data-path="slr.html"><a href="slr.html#dunnett"><i class="fa fa-check"></i><b>2.5.2</b> Dunnett’s Test</a></li>
<li class="chapter" data-level="2.5.3" data-path="slr.html"><a href="slr.html#python-code-10"><i class="fa fa-check"></i><b>2.5.3</b> Python Code</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="slr.html"><a href="slr.html#cor"><i class="fa fa-check"></i><b>2.6</b> Pearson Correlation</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="slr.html"><a href="slr.html#testcor"><i class="fa fa-check"></i><b>2.6.1</b> Statistical Test</a></li>
<li class="chapter" data-level="2.6.2" data-path="slr.html"><a href="slr.html#effect-of-anomalous-observations"><i class="fa fa-check"></i><b>2.6.2</b> Effect of Anomalous Observations</a></li>
<li class="chapter" data-level="2.6.3" data-path="slr.html"><a href="slr.html#the-correlation-matrix"><i class="fa fa-check"></i><b>2.6.3</b> The Correlation Matrix</a></li>
<li class="chapter" data-level="2.6.4" data-path="slr.html"><a href="slr.html#python-code-11"><i class="fa fa-check"></i><b>2.6.4</b> Python Code</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="slr.html"><a href="slr.html#simple-linear-regression"><i class="fa fa-check"></i><b>2.7</b> Simple Linear Regression</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="slr.html"><a href="slr.html#slrassumptions"><i class="fa fa-check"></i><b>2.7.1</b> Assumptions of Linear Regression</a></li>
<li class="chapter" data-level="2.7.2" data-path="slr.html"><a href="slr.html#testing-for-association"><i class="fa fa-check"></i><b>2.7.2</b> Testing for Association</a></li>
<li class="chapter" data-level="2.7.3" data-path="slr.html"><a href="slr.html#python-code-12"><i class="fa fa-check"></i><b>2.7.3</b> Python Code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="mlr.html"><a href="mlr.html"><i class="fa fa-check"></i><b>3</b> Complex ANOVA and Multiple Linear Regression</a>
<ul>
<li class="chapter" data-level="3.1" data-path="mlr.html"><a href="mlr.html#two-way-anova"><i class="fa fa-check"></i><b>3.1</b> Two-Way ANOVA</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="mlr.html"><a href="mlr.html#exploration"><i class="fa fa-check"></i><b>3.1.1</b> Exploration</a></li>
<li class="chapter" data-level="3.1.2" data-path="mlr.html"><a href="mlr.html#model"><i class="fa fa-check"></i><b>3.1.2</b> Model</a></li>
<li class="chapter" data-level="3.1.3" data-path="mlr.html"><a href="mlr.html#post-hoc-testing"><i class="fa fa-check"></i><b>3.1.3</b> Post-Hoc Testing</a></li>
<li class="chapter" data-level="3.1.4" data-path="mlr.html"><a href="mlr.html#python-code-13"><i class="fa fa-check"></i><b>3.1.4</b> Python Code</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="mlr.html"><a href="mlr.html#two-way-anova-with-interactions"><i class="fa fa-check"></i><b>3.2</b> Two-Way ANOVA with Interactions</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="mlr.html"><a href="mlr.html#post-hoc-testing-1"><i class="fa fa-check"></i><b>3.2.1</b> Post-Hoc Testing</a></li>
<li class="chapter" data-level="3.2.2" data-path="mlr.html"><a href="mlr.html#assumptions"><i class="fa fa-check"></i><b>3.2.2</b> Assumptions</a></li>
<li class="chapter" data-level="3.2.3" data-path="mlr.html"><a href="mlr.html#python-code-14"><i class="fa fa-check"></i><b>3.2.3</b> Python Code</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="mlr.html"><a href="mlr.html#randomized-block-design"><i class="fa fa-check"></i><b>3.3</b> Randomized Block Design</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="mlr.html"><a href="mlr.html#garlic-bulb-weight-example"><i class="fa fa-check"></i><b>3.3.1</b> Garlic Bulb Weight Example</a></li>
<li class="chapter" data-level="3.3.2" data-path="mlr.html"><a href="mlr.html#assumptions-1"><i class="fa fa-check"></i><b>3.3.2</b> Assumptions</a></li>
<li class="chapter" data-level="3.3.3" data-path="mlr.html"><a href="mlr.html#python-code-15"><i class="fa fa-check"></i><b>3.3.3</b> Python Code</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="mlr.html"><a href="mlr.html#multiple-linear-regression"><i class="fa fa-check"></i><b>3.4</b> Multiple Linear Regression</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="mlr.html"><a href="mlr.html#model-structure"><i class="fa fa-check"></i><b>3.4.1</b> Model Structure</a></li>
<li class="chapter" data-level="3.4.2" data-path="mlr.html"><a href="mlr.html#global-local-inference"><i class="fa fa-check"></i><b>3.4.2</b> Global &amp; Local Inference</a></li>
<li class="chapter" data-level="3.4.3" data-path="mlr.html"><a href="mlr.html#assumptions-2"><i class="fa fa-check"></i><b>3.4.3</b> Assumptions</a></li>
<li class="chapter" data-level="3.4.4" data-path="mlr.html"><a href="mlr.html#multiple-coefficients-of-determination"><i class="fa fa-check"></i><b>3.4.4</b> Multiple Coefficients of Determination</a></li>
<li class="chapter" data-level="3.4.5" data-path="mlr.html"><a href="mlr.html#categorical-predictor-variables"><i class="fa fa-check"></i><b>3.4.5</b> Categorical Predictor Variables</a></li>
<li class="chapter" data-level="3.4.6" data-path="mlr.html"><a href="mlr.html#python-code-16"><i class="fa fa-check"></i><b>3.4.6</b> Python Code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="sel.html"><a href="sel.html"><i class="fa fa-check"></i><b>4</b> Model Selection</a>
<ul>
<li class="chapter" data-level="4.1" data-path="sel.html"><a href="sel.html#selection-criteria"><i class="fa fa-check"></i><b>4.1</b> Selection Criteria</a></li>
<li class="chapter" data-level="4.2" data-path="sel.html"><a href="sel.html#stepwise-selection"><i class="fa fa-check"></i><b>4.2</b> Stepwise Selection</a>
<ul>
<li class="chapter" data-level="" data-path="sel.html"><a href="sel.html#forward"><i class="fa fa-check"></i>Forward</a></li>
<li class="chapter" data-level="" data-path="sel.html"><a href="sel.html#backward"><i class="fa fa-check"></i>Backward</a></li>
<li class="chapter" data-level="" data-path="sel.html"><a href="sel.html#stepwise"><i class="fa fa-check"></i>Stepwise</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="sel.html"><a href="sel.html#significance-levels"><i class="fa fa-check"></i><b>4.3</b> Significance Levels</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="sel.html"><a href="sel.html#python-code-17"><i class="fa fa-check"></i><b>4.3.1</b> Python Code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="diag.html"><a href="diag.html"><i class="fa fa-check"></i><b>5</b> Diagnostics</a>
<ul>
<li class="chapter" data-level="5.0.1" data-path="diag.html"><a href="diag.html#python-code-18"><i class="fa fa-check"></i><b>5.0.1</b> Python Code</a></li>
<li class="chapter" data-level="5.1" data-path="diag.html"><a href="diag.html#examining-residuals"><i class="fa fa-check"></i><b>5.1</b> Examining Residuals</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="diag.html"><a href="diag.html#python-code-19"><i class="fa fa-check"></i><b>5.1.1</b> Python Code</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="diag.html"><a href="diag.html#misspecified-model"><i class="fa fa-check"></i><b>5.2</b> Misspecified Model</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="diag.html"><a href="diag.html#python-code-20"><i class="fa fa-check"></i><b>5.2.1</b> Python Code</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="diag.html"><a href="diag.html#constant-variance"><i class="fa fa-check"></i><b>5.3</b> Constant Variance</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="diag.html"><a href="diag.html#python-code-21"><i class="fa fa-check"></i><b>5.3.1</b> Python Code</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="diag.html"><a href="diag.html#normality"><i class="fa fa-check"></i><b>5.4</b> Normality</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="diag.html"><a href="diag.html#python-code-22"><i class="fa fa-check"></i><b>5.4.1</b> Python Code</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="diag.html"><a href="diag.html#correlated-errors"><i class="fa fa-check"></i><b>5.5</b> Correlated Errors</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="diag.html"><a href="diag.html#python-code-23"><i class="fa fa-check"></i><b>5.5.1</b> Python Code</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="diag.html"><a href="diag.html#influential-observations-and-outliers"><i class="fa fa-check"></i><b>5.6</b> Influential Observations and Outliers</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="diag.html"><a href="diag.html#python-code-24"><i class="fa fa-check"></i><b>5.6.1</b> Python Code</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="diag.html"><a href="diag.html#multicollinearity"><i class="fa fa-check"></i><b>5.7</b> Multicollinearity</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="diag.html"><a href="diag.html#python-code-25"><i class="fa fa-check"></i><b>5.7.1</b> Python Code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="mlr.html"><a href="mlr.html#model"><i class="fa fa-check"></i><b>6</b> Model Building &amp; Scoring for Prediction</a>
<ul>
<li class="chapter" data-level="6.1" data-path="model.html"><a href="model.html"><i class="fa fa-check"></i><b>6.1</b> Regularized Regression</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="model.html"><a href="model.html#penalties-in-models"><i class="fa fa-check"></i><b>6.1.1</b> Penalties in Models</a></li>
<li class="chapter" data-level="6.1.2" data-path="model.html"><a href="model.html#ridge-regression"><i class="fa fa-check"></i><b>6.1.2</b> Ridge Regression</a></li>
<li class="chapter" data-level="6.1.3" data-path="model.html"><a href="model.html#lasso"><i class="fa fa-check"></i><b>6.1.3</b> LASSO</a></li>
<li class="chapter" data-level="6.1.4" data-path="model.html"><a href="model.html#elastic-net"><i class="fa fa-check"></i><b>6.1.4</b> Elastic Net</a></li>
<li class="chapter" data-level="6.1.5" data-path="model.html"><a href="model.html#python-code-26"><i class="fa fa-check"></i><b>6.1.5</b> Python Code</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="model.html"><a href="model.html#optimizing-penalties"><i class="fa fa-check"></i><b>6.2</b> Optimizing Penalties</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="model.html"><a href="model.html#cross-validation"><i class="fa fa-check"></i><b>6.2.1</b> Cross-Validation</a></li>
<li class="chapter" data-level="6.2.2" data-path="model.html"><a href="model.html#cv-in-regularized-regression"><i class="fa fa-check"></i><b>6.2.2</b> CV in Regularized Regression</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="model.html"><a href="model.html#model-comparisons"><i class="fa fa-check"></i><b>6.3</b> Model Comparisons</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="model.html"><a href="model.html#model-metrics"><i class="fa fa-check"></i><b>6.3.1</b> Model Metrics</a></li>
<li class="chapter" data-level="6.3.2" data-path="model.html"><a href="model.html#test-dataset-comparison"><i class="fa fa-check"></i><b>6.3.2</b> Test Dataset Comparison</a></li>
<li class="chapter" data-level="6.3.3" data-path="model.html"><a href="model.html#python-code-27"><i class="fa fa-check"></i><b>6.3.3</b> Python Code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="cat.html"><a href="cat.html"><i class="fa fa-check"></i><b>7</b> Categorical Data Analysis</a>
<ul>
<li class="chapter" data-level="7.1" data-path="cat.html"><a href="cat.html#describing-categorical-data"><i class="fa fa-check"></i><b>7.1</b> Describing Categorical Data</a></li>
<li class="chapter" data-level="7.2" data-path="cat.html"><a href="cat.html#tests-of-association"><i class="fa fa-check"></i><b>7.2</b> Tests of Association</a></li>
<li class="chapter" data-level="7.3" data-path="cat.html"><a href="cat.html#measures-of-association"><i class="fa fa-check"></i><b>7.3</b> Measures of Association</a></li>
<li class="chapter" data-level="7.4" data-path="cat.html"><a href="cat.html#introduction-to-logistic-regression"><i class="fa fa-check"></i><b>7.4</b> Introduction to Logistic Regression</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="cat.html"><a href="cat.html#linear-probability-model"><i class="fa fa-check"></i><b>7.4.1</b> Linear Probability Model</a></li>
<li class="chapter" data-level="7.4.2" data-path="cat.html"><a href="cat.html#binary-logistic-regression"><i class="fa fa-check"></i><b>7.4.2</b> Binary Logistic Regression</a></li>
<li class="chapter" data-level="7.4.3" data-path="cat.html"><a href="cat.html#adding-categorical-variables"><i class="fa fa-check"></i><b>7.4.3</b> Adding Categorical Variables</a></li>
<li class="chapter" data-level="7.4.4" data-path="cat.html"><a href="cat.html#model-assessment"><i class="fa fa-check"></i><b>7.4.4</b> Model Assessment</a></li>
<li class="chapter" data-level="7.4.5" data-path="cat.html"><a href="cat.html#variable-selection-and-regularized-regression"><i class="fa fa-check"></i><b>7.4.5</b> Variable Selection and Regularized Regression</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Foundations</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="model" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> Model Building &amp; Scoring for Prediction<a href="mlr.html#model" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In the preceding chapters, we have only scratched the surface of model building. Linear regression is a great initial approach to take to model building. In fact, in the realm of statistical models, linear regression (calculated by ordinary least squares) is the <strong>best linear unbiased estimator</strong>. The two key pieces to that previous statement are “best” and “unbiased.”</p>
<p>What does it mean to be <strong>unbiased</strong>? Each of the sample coefficients (<span class="math inline">\(\hat{\beta}\)</span>’s) in the regression model are estimates of the true coefficients. Just like the statistics back in the EDA section, these sample coefficients have sampling distributions - specifically, normally distributed sampling distributions. The mean of the sampling distribution of <span class="math inline">\(\hat{\beta}_j\)</span> is the true (known) coefficient <span class="math inline">\(\beta_j\)</span>. This means the coefficient is unbiased.</p>
<p>What does it mean to be <strong>best</strong>? <em>IF</em> the assumptions of ordinary least squares are met fully, then the sampling distributions of the coefficients in the model have the <strong>minimum</strong> variance of all unbiased estimators.</p>
<p>These two things combined seem like what we want in a model - estimating what we want (unbiased) and doing it in a way that has the minimum amount of variation (best among the unbiased). Again, these rely on the assumptions of linear regression holding true. Another approach to regression would be to use <strong>regularized regression</strong> instead as a different approach to building the model.</p>
<p>This Chapter aims to answer the following questions:</p>
<ul>
<li><p>What is regularized regression?</p>
<ul>
<li>Penalties in Modeling</li>
<li>Ridge Regression</li>
<li>LASSO</li>
<li>Elastic Net</li>
</ul></li>
<li><p>How do you optimize the penalty term?</p>
<ul>
<li>Overfitting</li>
<li>Cross-Validation (CV)</li>
<li>CV in Regularized Regression</li>
</ul></li>
<li><p>How do you compare different types of models?</p>
<ul>
<li>Model Metric</li>
<li>Model Scoring</li>
<li>Test Dataset Comparison</li>
</ul></li>
</ul>
<div id="regularized-regression" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Regularized Regression<a href="model.html#regularized-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>As the number of variables in a linear regression model increase, the chances of having a model that meets all of the assumptions starts to diminish. Multicollinearity can pose a large problem with bigger regression models. As previously seen in Chapter <a href="diag.html#diag">5</a>, the coefficients of a linear regression vary widely in the presence of multicollinearity. These variations lead to overfitting of a regression model. <strong>Overfitting</strong> occurs when a dataset predicts the training data it was built off of really well, but does not generalize to the test dataset or the population in general. More formally, these models have higher variance than desired. In those scenarios, moving out of the realm of unbiased estimates may provide a lower variance in the model, even though the model is no longer unbiased as described above. We wouldn’t want to be too biased, but some small degree of bias might improve the model’s fit overall.</p>
<p>Another potential problem for linear regression is when we have more variables than observations in our dataset. This is a common problem in the space of genetic modeling. In this scenario, the ordinary least squares approach leads to multiple solutions instead of just one. Unfortunately, most of these infinite solutions overfit the problem at hand anyway.</p>
<p>Regularized (or penalized or shrinkage) regression techniques potentially alleviate these problems. Regularized regression puts constraints on the estimated coefficients in our model and <em>shrink</em> these estimates to zero. This helps reduce the variation in the coefficients (improving the variance of the model), but at the cost of biasing the coefficients. The specific constraints that are put on the regression inform the three common approaches - <strong>ridge regression</strong>, <strong>LASSO</strong>, and <strong>elastic nets</strong>.</p>
<div id="penalties-in-models" class="section level3 hasAnchor" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> Penalties in Models<a href="model.html#penalties-in-models" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In ordinary least squares linear regression, we minimize the sum of the squared residuals (or errors) as laid out in Chapter @(slr).</p>
<p>In ordinary least squares linear regression, we minimize the sum of the squared residuals (or errors) as laid out in Chapter <a href="slr.html#slr">2</a>.</p>
<p><span class="math display">\[
min(\sum_{i=1}^n(y_i - \hat{y}_i)^2) = min(SSE)
\]</span></p>
<p>In regularized regression, however, we add a penalty term to the <span class="math inline">\(SSE\)</span> as follows:</p>
<p><span class="math display">\[
min(\sum_{i=1}^n(y_i - \hat{y}_i)^2 + Penalty) = min(SSE + Penalty)
\]</span></p>
<p>As mentioned above, the penalties we choose constrain the estimated coefficients in our model and shrink these estimates to zero. Different penalties have different effects on the estimated coefficients. Two common approaches to adding penalties are the ridge and LASSO approaches. The elastic net approach is a combination of these two. Let’s explore each of these in further detail!</p>
</div>
<div id="ridge-regression" class="section level3 hasAnchor" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> Ridge Regression<a href="model.html#ridge-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Ridge regression adds what is commonly referred to as an “<span class="math inline">\(L_2\)</span>” penalty:</p>
<p><span class="math display">\[
min(\sum_{i=1}^n(y_i - \hat{y}_i)^2 + \lambda \sum_{j=1}^p \hat{\beta}^2_j) = min(SSE + \lambda \sum_{j=1}^p \hat{\beta}^2_j)
\]</span></p>
<p>This penalty is controlled by the <strong>tuning parameter</strong> <span class="math inline">\(\lambda\)</span>. If <span class="math inline">\(\lambda = 0\)</span>, then we have typical OLS linear regression. However, as <span class="math inline">\(\lambda \rightarrow \infty\)</span>, the coefficients in the model shrink to zero. This makes intuitive sense. Since the estimated coefficients, <span class="math inline">\(\hat{\beta}_j\)</span>’s, are the only thing changing to minimize this equation, then as <span class="math inline">\(\lambda \rightarrow \infty\)</span>, the equation is best minimized by forcing the coefficients to be smaller and smaller. We will see how to optimize this penalty term in a later section.</p>
<p>Let’s build a regularized regression for our Ames dataset. To build a ridge regression we need separate data matrices for our predictors and our target variable. First, we isolate out the variables we are interested in using the <code>select</code> function. From there the <code>model.matrix</code> function will create any categorical dummy variables needed. We also isolate the target variable into its own vector.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="model.html#cb1-1" aria-hidden="true" tabindex="-1"></a>train_reg <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span> </span>
<span id="cb1-2"><a href="model.html#cb1-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Sale_Price, </span>
<span id="cb1-3"><a href="model.html#cb1-3" aria-hidden="true" tabindex="-1"></a>         Lot_Area,</span>
<span id="cb1-4"><a href="model.html#cb1-4" aria-hidden="true" tabindex="-1"></a>         Street,</span>
<span id="cb1-5"><a href="model.html#cb1-5" aria-hidden="true" tabindex="-1"></a>         Bldg_Type,</span>
<span id="cb1-6"><a href="model.html#cb1-6" aria-hidden="true" tabindex="-1"></a>         House_Style,</span>
<span id="cb1-7"><a href="model.html#cb1-7" aria-hidden="true" tabindex="-1"></a>         Overall_Qual,</span>
<span id="cb1-8"><a href="model.html#cb1-8" aria-hidden="true" tabindex="-1"></a>         Roof_Style,</span>
<span id="cb1-9"><a href="model.html#cb1-9" aria-hidden="true" tabindex="-1"></a>         Central_Air,</span>
<span id="cb1-10"><a href="model.html#cb1-10" aria-hidden="true" tabindex="-1"></a>         First_Flr_SF,</span>
<span id="cb1-11"><a href="model.html#cb1-11" aria-hidden="true" tabindex="-1"></a>         Second_Flr_SF,</span>
<span id="cb1-12"><a href="model.html#cb1-12" aria-hidden="true" tabindex="-1"></a>         Full_Bath,</span>
<span id="cb1-13"><a href="model.html#cb1-13" aria-hidden="true" tabindex="-1"></a>         Half_Bath,</span>
<span id="cb1-14"><a href="model.html#cb1-14" aria-hidden="true" tabindex="-1"></a>         Fireplaces,</span>
<span id="cb1-15"><a href="model.html#cb1-15" aria-hidden="true" tabindex="-1"></a>         Garage_Area,</span>
<span id="cb1-16"><a href="model.html#cb1-16" aria-hidden="true" tabindex="-1"></a>         Gr_Liv_Area, </span>
<span id="cb1-17"><a href="model.html#cb1-17" aria-hidden="true" tabindex="-1"></a>         TotRms_AbvGrd) <span class="sc">%&gt;%</span></span>
<span id="cb1-18"><a href="model.html#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>)</span>
<span id="cb1-19"><a href="model.html#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="model.html#cb1-20" aria-hidden="true" tabindex="-1"></a>train_x <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(Sale_Price <span class="sc">~</span> ., <span class="at">data =</span> train_reg)[, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb1-21"><a href="model.html#cb1-21" aria-hidden="true" tabindex="-1"></a>train_y <span class="ot">&lt;-</span> train_reg<span class="sc">$</span>Sale_Price</span></code></pre></div>
<p>We will want to do the same thing for the test dataset as well.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="model.html#cb2-1" aria-hidden="true" tabindex="-1"></a>test_reg <span class="ot">&lt;-</span> test <span class="sc">%&gt;%</span> </span>
<span id="cb2-2"><a href="model.html#cb2-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Sale_Price, </span>
<span id="cb2-3"><a href="model.html#cb2-3" aria-hidden="true" tabindex="-1"></a>         Lot_Area,</span>
<span id="cb2-4"><a href="model.html#cb2-4" aria-hidden="true" tabindex="-1"></a>         Street,</span>
<span id="cb2-5"><a href="model.html#cb2-5" aria-hidden="true" tabindex="-1"></a>         Bldg_Type,</span>
<span id="cb2-6"><a href="model.html#cb2-6" aria-hidden="true" tabindex="-1"></a>         House_Style,</span>
<span id="cb2-7"><a href="model.html#cb2-7" aria-hidden="true" tabindex="-1"></a>         Overall_Qual,</span>
<span id="cb2-8"><a href="model.html#cb2-8" aria-hidden="true" tabindex="-1"></a>         Roof_Style,</span>
<span id="cb2-9"><a href="model.html#cb2-9" aria-hidden="true" tabindex="-1"></a>         Central_Air,</span>
<span id="cb2-10"><a href="model.html#cb2-10" aria-hidden="true" tabindex="-1"></a>         First_Flr_SF,</span>
<span id="cb2-11"><a href="model.html#cb2-11" aria-hidden="true" tabindex="-1"></a>         Second_Flr_SF,</span>
<span id="cb2-12"><a href="model.html#cb2-12" aria-hidden="true" tabindex="-1"></a>         Full_Bath,</span>
<span id="cb2-13"><a href="model.html#cb2-13" aria-hidden="true" tabindex="-1"></a>         Half_Bath,</span>
<span id="cb2-14"><a href="model.html#cb2-14" aria-hidden="true" tabindex="-1"></a>         Fireplaces,</span>
<span id="cb2-15"><a href="model.html#cb2-15" aria-hidden="true" tabindex="-1"></a>         Garage_Area,</span>
<span id="cb2-16"><a href="model.html#cb2-16" aria-hidden="true" tabindex="-1"></a>         Gr_Liv_Area, </span>
<span id="cb2-17"><a href="model.html#cb2-17" aria-hidden="true" tabindex="-1"></a>         TotRms_AbvGrd) <span class="sc">%&gt;%</span></span>
<span id="cb2-18"><a href="model.html#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>)</span>
<span id="cb2-19"><a href="model.html#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="model.html#cb2-20" aria-hidden="true" tabindex="-1"></a>test_x <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(Sale_Price <span class="sc">~</span> ., <span class="at">data =</span> test_reg)[, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb2-21"><a href="model.html#cb2-21" aria-hidden="true" tabindex="-1"></a>test_y <span class="ot">&lt;-</span> test_reg<span class="sc">$</span>Sale_Price</span></code></pre></div>
<p>From there we use the <code>glmnet</code> function with the <code>x =</code> option where we specify the predictor model matrix and the <code>y =</code> option where we specify the target variable. The <code>alpha = 0</code> option specifies that a ridge regression will be used as defined in more detail below in the elastic net section. The <code>plot</code> function allows us to see the impact of the penalty on the coefficients in the model.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="model.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb3-2"><a href="model.html#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="model.html#cb3-3" aria-hidden="true" tabindex="-1"></a>ames_ridge <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(<span class="at">x =</span> train_x,  <span class="at">y =</span> train_y,  <span class="at">alpha =</span> <span class="dv">0</span>)</span>
<span id="cb3-4"><a href="model.html#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="model.html#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ames_ridge, <span class="at">xvar =</span> <span class="st">&quot;lambda&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>The <code>glmnet</code> function automatically standardizes the variables before fitting the regression model. This is important so that all of the variables are on the same scale before adjustments are made to the estimated coefficients. Even with this standardization we can see the large coefficient values for some of the variables. The top of the plot lists how many variables are in the model at each value of penalty. This will never change for ridge regression, but does for LASSO.</p>
<p>What <span class="math inline">\(\lambda\)</span> term is best? That will be discussed in the optimizing section below, but let’s discuss other possible penalties first.</p>
</div>
<div id="lasso" class="section level3 hasAnchor" number="6.1.3">
<h3><span class="header-section-number">6.1.3</span> LASSO<a href="model.html#lasso" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Least absolute shrinkage and selection operator</strong> (LASSO) regression adds what is commonly referred to as an “<span class="math inline">\(L_1\)</span>” penalty:</p>
<p><span class="math display">\[
min(\sum_{i=1}^n(y_i - \hat{y}_i)^2 + \lambda \sum_{j=1}^p |\hat{\beta}_j|) = min(SSE + \lambda \sum_{j=1}^p |\hat{\beta}_j|)
\]</span></p>
<p>This penalty is controlled by the <strong>tuning parameter</strong> <span class="math inline">\(\lambda\)</span>. If <span class="math inline">\(\lambda = 0\)</span>, then we have typical OLS linear regression. However, as <span class="math inline">\(\lambda \rightarrow \infty\)</span>, the coefficients in the model shrink to zero. This makes intuitive sense. Since the estimated coefficients, <span class="math inline">\(\hat{\beta}_j\)</span>’s, are the only thing changing to minimize this equation, then as <span class="math inline">\(\lambda \rightarrow \infty\)</span>, the equation is best minimized by forcing the coefficients to be smaller and smaller. We will see how to optimize this penalty term in a later section.</p>
<p>However, unlike ridge regression that has the coefficient estimates approach zero asymptotically, in LASSO regression the coefficients can actually equal zero. This may not be as intuitive when initially looking at the penalty terms themselves. It becomes easier to see when dealing with the solutions to the coefficient estimates. Without going into too much mathematical detail, this is done by taking the derivative of the minimization function (objective function) and setting it equal to zero. From there we can determine the optimal solution for the estimated coefficients. In OLS regression the estimates for the coefficients can be shown to equal the following (in matrix form):</p>
<p><span class="math display">\[
\hat{\beta} = (X^TX)^{-1}X^TY
\]</span></p>
<p>This changes in the presence of penalty terms. For ridge regression, the solution becomes the following:</p>
<p><span class="math display">\[
\hat{\beta} = (X^TX + \lambda I)^{-1}X^TY
\]</span></p>
<p>There is no value for <span class="math inline">\(\lambda\)</span> that can force the coefficients to be zero by itself. Therefore, unless the data makes the coefficient zero, the penalty term can only force the estimated coefficient to zero asymptotically as <span class="math inline">\(\lambda \rightarrow \infty\)</span>.</p>
<p>However, for LASSO, the solution becomes the following:</p>
<p><span class="math display">\[
\hat{\beta} = (X^TX)^{-1}(X^TY - \lambda I)
\]</span></p>
<p>Notice the distinct difference here. In this scenario, there is a possible penalty value (<span class="math inline">\(\lambda = X^TY\)</span>) that will force the estimated coefficients to equal zero. There is some benefit to this. This makes LASSO also function as a variable selection criteria as well.</p>
<p>Let’s build a regularized regression for our Ames dataset using the LASSO approach. To build a LASSO regression we need separate data matrices for our predictors and our target variable just like we did for ridge. From there we use the <code>glmnet</code> function with the <code>x =</code> option where we specify the predictor model matrix and the <code>y =</code> option where we specify the target variable. The <code>alpha = 1</code> option specifies that a LASSO regression will be used as defined in more detail below in the elastic net section. The <code>plot</code> function allows us to see the impact of the penalty on the coefficients in the model.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="model.html#cb4-1" aria-hidden="true" tabindex="-1"></a>ames_lasso <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(<span class="at">x =</span> train_x,  <span class="at">y =</span> train_y,  <span class="at">alpha =</span> <span class="dv">1</span>)</span>
<span id="cb4-2"><a href="model.html#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="model.html#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ames_lasso, <span class="at">xvar =</span> <span class="st">&quot;lambda&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>The <code>glmnet</code> function automatically standardizes the variables before fitting the regression model. This is important so that all of the variables are on the same scale before adjustments are made to the estimated coefficients. Even with this standardization we can see the large coefficient values for some of the variables. The top of the plot lists how many variables are in the model at each value of penalty. Notice as the penalty increases, the number of variables decreases as variables are forced to zero.</p>
<p>What <span class="math inline">\(\lambda\)</span> term is best? That will be discussed in the optimizing section below, but let’s discuss the last possible penalty first - the combination of both ridge and LASSO.</p>
</div>
<div id="elastic-net" class="section level3 hasAnchor" number="6.1.4">
<h3><span class="header-section-number">6.1.4</span> Elastic Net<a href="model.html#elastic-net" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Which approach is better, ridge or LASSO? Both have advantages and disadvantages. LASSO performs variable selection while ridge keeps all variables in the model. However, reducing the number of variables might impact minimum error. Also, if you have two correlated variables, which one LASSO chooses to zero out is relatively arbitrary to the context of the problem.</p>
<p>Elastic nets were designed to take advantage of both penalty approaches. In elastic nets, we are using both penalties in the minimization:</p>
<p><span class="math display">\[
min(SSE + \lambda_1 \sum_{j=1}^p |\hat{\beta}_j| + \lambda_2 \sum_{j=1}^p \hat{\beta}^2_j)
\]</span></p>
<p>In R, the <code>glmnet</code> function takes a slightly different approach to the elastic net implementation with the following:</p>
<p><span class="math display">\[
min(SSE + \lambda[ \alpha \sum_{j=1}^p |\hat{\beta}_j| + (1-\alpha) \sum_{j=1}^p \hat{\beta}^2_j])
\]</span></p>
<p>R still has one penalty <span class="math inline">\(\lambda\)</span>, however, it includes the <span class="math inline">\(\alpha\)</span> parameter to balance between the two penalty terms. This is why in <code>glmnet</code>, the <code>alpha = 1</code> option gives a LASSO regression and <code>alpha = 0</code> gives a ridge regression. Any value in between zero and one will provide an elastic net.</p>
<p>Let’s build a regularized regression for our Ames dataset using the elastic net approach with an <span class="math inline">\(\alpha = 0.5\)</span>. To build am elastic net we need separate data matrices for our predictors and our target variable just like we did for ridge and LASSO. From there we use the <code>glmnet</code> function with the <code>x =</code> option where we specify the predictor model matrix and the <code>y =</code> option where we specify the target variable. The <code>alpha = 0.5</code> option specifies that an elastic net will be used since it is between zero and one. The <code>plot</code> function allows us to see the impact of the penalty on the coefficients in the model.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="model.html#cb5-1" aria-hidden="true" tabindex="-1"></a>ames_en <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(<span class="at">x =</span> train_x,  <span class="at">y =</span> train_y,  <span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb5-2"><a href="model.html#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="model.html#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ames_en, <span class="at">xvar =</span> <span class="st">&quot;lambda&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>The <code>glmnet</code> function automatically standardizes the variables before fitting the regression model. This is important so that all of the variables are on the same scale before adjustments are made to the estimated coefficients. Even with this standardization we can see the large coefficient values for some of the variables. The top of the plot lists how many variables are in the model at each value of penalty. Notice as the penalty increases, the number of variables decreases as variables are forced to zero using the LASSO piece of the elastic net penalty.</p>
<p>What <span class="math inline">\(\lambda\)</span> term is best? What is the proper balance between ridge and LASSO penalties when building an elastic net? That will be discussed in the following section.</p>
</div>
<div id="python-code-26" class="section level3 hasAnchor" number="6.1.5">
<h3><span class="header-section-number">6.1.5</span> Python Code<a href="model.html#python-code-26" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>Ridge Regression</em></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="model.html#cb6-1" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> train[[<span class="st">&#39;Sale_Price&#39;</span>, <span class="st">&#39;Lot_Area&#39;</span>, <span class="st">&#39;Street&#39;</span>, <span class="st">&#39;Bldg_Type&#39;</span>,</span>
<span id="cb6-2"><a href="model.html#cb6-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">&#39;House_Style&#39;</span>, <span class="st">&#39;Overall_Qual&#39;</span>, <span class="st">&#39;Roof_Style&#39;</span>, </span>
<span id="cb6-3"><a href="model.html#cb6-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">&#39;Central_Air&#39;</span>, <span class="st">&#39;First_Flr_SF&#39;</span>, <span class="st">&#39;Second_Flr_SF&#39;</span>, </span>
<span id="cb6-4"><a href="model.html#cb6-4" aria-hidden="true" tabindex="-1"></a>               <span class="st">&#39;Full_Bath&#39;</span>, <span class="st">&#39;Half_Bath&#39;</span>, <span class="st">&#39;Fireplaces&#39;</span>, </span>
<span id="cb6-5"><a href="model.html#cb6-5" aria-hidden="true" tabindex="-1"></a>               <span class="st">&#39;Garage_Area&#39;</span>, <span class="st">&#39;Gr_Liv_Area&#39;</span>, <span class="st">&#39;TotRms_AbvGrd&#39;</span>]]</span>
<span id="cb6-6"><a href="model.html#cb6-6" aria-hidden="true" tabindex="-1"></a>               </span>
<span id="cb6-7"><a href="model.html#cb6-7" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> train.fillna(<span class="dv">0</span>)</span>
<span id="cb6-8"><a href="model.html#cb6-8" aria-hidden="true" tabindex="-1"></a>               </span>
<span id="cb6-9"><a href="model.html#cb6-9" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> test[[<span class="st">&#39;Sale_Price&#39;</span>, <span class="st">&#39;Lot_Area&#39;</span>, <span class="st">&#39;Street&#39;</span>, <span class="st">&#39;Bldg_Type&#39;</span>,</span>
<span id="cb6-10"><a href="model.html#cb6-10" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;House_Style&#39;</span>, <span class="st">&#39;Overall_Qual&#39;</span>, <span class="st">&#39;Roof_Style&#39;</span>, </span>
<span id="cb6-11"><a href="model.html#cb6-11" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;Central_Air&#39;</span>, <span class="st">&#39;First_Flr_SF&#39;</span>, <span class="st">&#39;Second_Flr_SF&#39;</span>, </span>
<span id="cb6-12"><a href="model.html#cb6-12" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;Full_Bath&#39;</span>, <span class="st">&#39;Half_Bath&#39;</span>, <span class="st">&#39;Fireplaces&#39;</span>, </span>
<span id="cb6-13"><a href="model.html#cb6-13" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;Garage_Area&#39;</span>, <span class="st">&#39;Gr_Liv_Area&#39;</span>, <span class="st">&#39;TotRms_AbvGrd&#39;</span>]]</span>
<span id="cb6-14"><a href="model.html#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="model.html#cb6-15" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> test.fillna(<span class="dv">0</span>)</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="model.html#cb7-1" aria-hidden="true" tabindex="-1"></a>train_dummy <span class="op">=</span> pd.get_dummies(train, columns <span class="op">=</span> [<span class="st">&#39;Street&#39;</span>, <span class="st">&#39;Bldg_Type&#39;</span>, <span class="st">&#39;House_Style&#39;</span>, <span class="st">&#39;Overall_Qual&#39;</span>, <span class="st">&#39;Roof_Style&#39;</span>, <span class="st">&#39;Central_Air&#39;</span>])</span>
<span id="cb7-2"><a href="model.html#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="model.html#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(train_dummy)</span></code></pre></div>
<pre><code>##       Sale_Price  Lot_Area  ...  Central_Air_N  Central_Air_Y
## 0         232600     11216  ...              0              1
## 1         166000      2998  ...              0              1
## 2         170000     17871  ...              0              1
## 3         252000     10574  ...              0              1
## 4         134000      6000  ...              0              1
## ...          ...       ...  ...            ...            ...
## 2046       72500      6627  ...              1              0
## 2047      137000     11425  ...              0              1
## 2048       80000      5220  ...              0              1
## 2049      221000     12803  ...              0              1
## 2050      102000      7288  ...              1              0
## 
## [2051 rows x 43 columns]</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="model.html#cb9-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> train_dummy[<span class="st">&#39;Sale_Price&#39;</span>]</span>
<span id="cb9-2"><a href="model.html#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="model.html#cb9-3" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> train_dummy.loc[:, train_dummy.columns <span class="op">!=</span> <span class="st">&#39;Sale_Price&#39;</span>]</span>
<span id="cb9-4"><a href="model.html#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="model.html#cb9-5" aria-hidden="true" tabindex="-1"></a>ames_ridge <span class="op">=</span> Ridge(alpha <span class="op">=</span> <span class="fl">1.0</span>).fit(X, y)</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="model.html#cb10-1" aria-hidden="true" tabindex="-1"></a>n_alphas <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb10-2"><a href="model.html#cb10-2" aria-hidden="true" tabindex="-1"></a>alphas <span class="op">=</span> np.logspace(<span class="fl">0.1</span>, <span class="dv">5</span>, n_alphas)</span>
<span id="cb10-3"><a href="model.html#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="model.html#cb10-4" aria-hidden="true" tabindex="-1"></a>coefs <span class="op">=</span> []</span>
<span id="cb10-5"><a href="model.html#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> alphas:</span>
<span id="cb10-6"><a href="model.html#cb10-6" aria-hidden="true" tabindex="-1"></a>    ridge <span class="op">=</span> Ridge(alpha<span class="op">=</span>a)</span>
<span id="cb10-7"><a href="model.html#cb10-7" aria-hidden="true" tabindex="-1"></a>    ridge.fit(X, y)</span>
<span id="cb10-8"><a href="model.html#cb10-8" aria-hidden="true" tabindex="-1"></a>    coefs.append(ridge.coef_)</span>
<span id="cb10-9"><a href="model.html#cb10-9" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<style>#sk-container-id-1 {color: black;background-color: white;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Ridge(alpha=100000.0)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">Ridge</label><div class="sk-toggleable__content"><pre>Ridge(alpha=100000.0)</pre></div></div></div></div></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="model.html#cb11-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.gca()</span>
<span id="cb11-2"><a href="model.html#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="model.html#cb11-3" aria-hidden="true" tabindex="-1"></a>ax.plot(alphas, coefs)</span>
<span id="cb11-4"><a href="model.html#cb11-4" aria-hidden="true" tabindex="-1"></a>ax.set_xscale(<span class="st">&quot;log&quot;</span>)</span>
<span id="cb11-5"><a href="model.html#cb11-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;alpha&quot;</span>)</span>
<span id="cb11-6"><a href="model.html#cb11-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;weights&quot;</span>)</span>
<span id="cb11-7"><a href="model.html#cb11-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Ridge coefficients as a function of the regularization&quot;</span>)</span>
<span id="cb11-8"><a href="model.html#cb11-8" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&quot;tight&quot;</span>)</span></code></pre></div>
<pre><code>## (0.716143410212902, 175792.36139586932, -75106.43079563054, 162751.90865728402)</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="model.html#cb13-1" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p><em>LASSO Regression</em></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="model.html#cb14-1" aria-hidden="true" tabindex="-1"></a>ames_lasso <span class="op">=</span> Lasso(alpha <span class="op">=</span> <span class="dv">2</span>, max_iter <span class="op">=</span> <span class="dv">5000</span>).fit(X, y)</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="model.html#cb15-1" aria-hidden="true" tabindex="-1"></a>n_alphas <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb15-2"><a href="model.html#cb15-2" aria-hidden="true" tabindex="-1"></a>alphas2 <span class="op">=</span> np.logspace(<span class="dv">2</span>, <span class="dv">5</span>, n_alphas)</span>
<span id="cb15-3"><a href="model.html#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="model.html#cb15-4" aria-hidden="true" tabindex="-1"></a>coefs2 <span class="op">=</span> []</span>
<span id="cb15-5"><a href="model.html#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> alphas2:</span>
<span id="cb15-6"><a href="model.html#cb15-6" aria-hidden="true" tabindex="-1"></a>    lasso <span class="op">=</span> Lasso(alpha <span class="op">=</span> a, max_iter <span class="op">=</span> <span class="dv">5000</span>)</span>
<span id="cb15-7"><a href="model.html#cb15-7" aria-hidden="true" tabindex="-1"></a>    lasso.fit(X, y)</span>
<span id="cb15-8"><a href="model.html#cb15-8" aria-hidden="true" tabindex="-1"></a>    coefs2.append(lasso.coef_)</span></code></pre></div>
<style>#sk-container-id-2 {color: black;background-color: white;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Lasso(alpha=100000.0, max_iter=5000)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">Lasso</label><div class="sk-toggleable__content"><pre>Lasso(alpha=100000.0, max_iter=5000)</pre></div></div></div></div></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="model.html#cb16-1" aria-hidden="true" tabindex="-1"></a>plt.cla()</span>
<span id="cb16-2"><a href="model.html#cb16-2" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> plt.gca()</span>
<span id="cb16-3"><a href="model.html#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="model.html#cb16-4" aria-hidden="true" tabindex="-1"></a>ax2.plot(alphas2, coefs2)</span>
<span id="cb16-5"><a href="model.html#cb16-5" aria-hidden="true" tabindex="-1"></a>ax2.set_xscale(<span class="st">&quot;log&quot;</span>)</span>
<span id="cb16-6"><a href="model.html#cb16-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;alpha&quot;</span>)</span>
<span id="cb16-7"><a href="model.html#cb16-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;weights&quot;</span>)</span>
<span id="cb16-8"><a href="model.html#cb16-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;LASSO coefficients as a function of the regularization&quot;</span>)</span>
<span id="cb16-9"><a href="model.html#cb16-9" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&quot;tight&quot;</span>)</span></code></pre></div>
<pre><code>## (70.79457843841381, 141253.75446227554, -36612.709965313596, 187518.38334362683)</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="model.html#cb18-1" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-13-3.png" width="672" /></p>
<ul>
<li>Elastic Net*</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="model.html#cb19-1" aria-hidden="true" tabindex="-1"></a>ames_en <span class="op">=</span> ElasticNet(alpha <span class="op">=</span> <span class="dv">1</span>, l1_ratio<span class="op">=</span><span class="fl">0.5</span>)</span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="model.html#cb20-1" aria-hidden="true" tabindex="-1"></a>n_alphas <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb20-2"><a href="model.html#cb20-2" aria-hidden="true" tabindex="-1"></a>alphas3 <span class="op">=</span> np.logspace(<span class="dv">1</span>, <span class="dv">8</span>, n_alphas)</span>
<span id="cb20-3"><a href="model.html#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="model.html#cb20-4" aria-hidden="true" tabindex="-1"></a>coefs3 <span class="op">=</span> []</span>
<span id="cb20-5"><a href="model.html#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> alphas3:</span>
<span id="cb20-6"><a href="model.html#cb20-6" aria-hidden="true" tabindex="-1"></a>    en <span class="op">=</span> ElasticNet(alpha <span class="op">=</span> a, l1_ratio<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb20-7"><a href="model.html#cb20-7" aria-hidden="true" tabindex="-1"></a>    en.fit(X, y)</span>
<span id="cb20-8"><a href="model.html#cb20-8" aria-hidden="true" tabindex="-1"></a>    coefs3.append(en.coef_)</span></code></pre></div>
<style>#sk-container-id-3 {color: black;background-color: white;}#sk-container-id-3 pre{padding: 0;}#sk-container-id-3 div.sk-toggleable {background-color: white;}#sk-container-id-3 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-3 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-3 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-3 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-3 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-3 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-3 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-3 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-3 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-3 div.sk-item {position: relative;z-index: 1;}#sk-container-id-3 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-3 div.sk-item::before, #sk-container-id-3 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-3 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-3 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-3 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-3 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-3 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-3 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-3 div.sk-label-container {text-align: center;}#sk-container-id-3 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-3 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>ElasticNet(alpha=100000000.0)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" checked><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">ElasticNet</label><div class="sk-toggleable__content"><pre>ElasticNet(alpha=100000000.0)</pre></div></div></div></div></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="model.html#cb21-1" aria-hidden="true" tabindex="-1"></a>plt.cla()</span>
<span id="cb21-2"><a href="model.html#cb21-2" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> plt.gca()</span>
<span id="cb21-3"><a href="model.html#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="model.html#cb21-4" aria-hidden="true" tabindex="-1"></a>ax3.plot(alphas3, coefs3)</span>
<span id="cb21-5"><a href="model.html#cb21-5" aria-hidden="true" tabindex="-1"></a>ax3.set_xscale(<span class="st">&quot;log&quot;</span>)</span>
<span id="cb21-6"><a href="model.html#cb21-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;alpha&quot;</span>)</span>
<span id="cb21-7"><a href="model.html#cb21-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;weights&quot;</span>)</span>
<span id="cb21-8"><a href="model.html#cb21-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;ElasticNet coefficients as a function of the regularization&quot;</span>)</span>
<span id="cb21-9"><a href="model.html#cb21-9" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&quot;tight&quot;</span>)</span></code></pre></div>
<pre><code>## (4.46683592150963, 223872113.8568338, -922.4074138311265, 951.0765209120289)</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="model.html#cb23-1" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-15-5.png" width="672" /></p>
</div>
</div>
<div id="optimizing-penalties" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Optimizing Penalties<a href="model.html#optimizing-penalties" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>No matter the approach listed above, a penatly term <span class="math inline">\(\lambda\)</span> needs to be picked. However, we do not want to get caught overfitting our training data by minimizing the variance so much that it is not generalizable to the overall pattern and other similar data. Take the following plot:</p>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-16-7.png" width="672" /></p>
<p>The red line is overfitted to the dataset and picks up too much of the unimportant pattern. The orange dotted line is underfit as it does not pick up enough of the pattern. The light blue, solid line is fit well to the dataset as it picks up the general pattern while not overfitting to the dataset.</p>
<div id="cross-validation" class="section level3 hasAnchor" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Cross-Validation<a href="model.html#cross-validation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Cross-validation</strong> is a common approach in modeling to prevent overfitting of data when you need to <strong>tune</strong> a parameter. The idea of cross-validation is to split the training data into multiple pieces, build the model on a majority of the pieces while evaluating it on the remaining piece. Then we do the same process again, but switch out which pieces the model is built and evaluated on.</p>
<p>A common cross-validation (CV) approach is the <span class="math inline">\(k\)</span>-fold CV. In the <span class="math inline">\(k\)</span>-fold CV approach, the model is built <span class="math inline">\(k\)</span> times. The data is initially split into <span class="math inline">\(k\)</span> equally sized pieces. Each time the model is built, it is built off of <span class="math inline">\(k-1\)</span> pieces of the data and evaluated on the last piece. This process is repeated until each piece is left out for evaluation. This is diagrammed below in Figure <a href="model.html#fig:kCV">6.1</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:kCV"></span>
<img src="img/kCV.png" alt="Example of a 10-fold Cross-Validation" width="50%" />
<p class="caption">
Figure 6.1: Example of a 10-fold Cross-Validation
</p>
</div>
</div>
<div id="cv-in-regularized-regression" class="section level3 hasAnchor" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> CV in Regularized Regression<a href="model.html#cv-in-regularized-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In R, the <code>cv.glmnet</code> function will automatically implement a 10-fold CV (by default, but can be adjusted through options) to help evaluate and optimize the <span class="math inline">\(\lambda\)</span> values for our regularized regression models.</p>
<p>Let’s perform an example using the LASSO regression. The <code>cv.glmnet</code> function takes the same inputs as the <code>glmnet</code> function above. Again, we will use the <code>plot</code> function, but this time we get a different plot.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="model.html#cb24-1" aria-hidden="true" tabindex="-1"></a>ames_lasso_cv <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(<span class="at">x =</span> train_x,  <span class="at">y =</span> train_y,  <span class="at">alpha =</span> <span class="dv">1</span>)</span>
<span id="cb24-2"><a href="model.html#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="model.html#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ames_lasso_cv)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="model.html#cb25-1" aria-hidden="true" tabindex="-1"></a>ames_lasso_cv<span class="sc">$</span>lambda.min </span></code></pre></div>
<pre><code>## [1] 41.25712</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="model.html#cb27-1" aria-hidden="true" tabindex="-1"></a>ames_lasso_cv<span class="sc">$</span>lambda<span class="fl">.1</span>se</span></code></pre></div>
<pre><code>## [1] 3588.334</code></pre>
<p>The above plot shows the results from our cross-validation. Here the models are evaluated based on their <strong>mean-squared error</strong> (MSE). The MSE is defined as <span class="math inline">\(\frac{1}{n} \sum_{i=1}^n (y_i - \hat{y}_i)^2\)</span>. The <span class="math inline">\(\lambda\)</span> value that minimizes the MSE is 49.69435 (with a <span class="math inline">\(\log(\lambda)\)</span> = 3.91). This is highlighted by the first, vertical dashed line. The second vertical dashed line is the largest <span class="math inline">\(\lambda\)</span> value that is one standard error above the minimum value. This value is especially useful in LASSO regressions. The largest <span class="math inline">\(\lambda\)</span> within one standard error would provide approximately the same MSE, but with a further reduction in the number of variables. Notice that to go from the first line to the second, the change in MSE is very small, but the reduction of variables is from 36 variables to around 12 variables.</p>
<p>Let’s look at the impact on the coefficients under this penalty using the <code>glmnet</code> function as before.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="model.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ames_lasso, <span class="at">xvar =</span> <span class="st">&quot;lambda&quot;</span>)</span>
<span id="cb29-2"><a href="model.html#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">log</span>(ames_lasso_cv<span class="sc">$</span>lambda<span class="fl">.1</span>se), <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb29-3"><a href="model.html#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">log</span>(ames_lasso_cv<span class="sc">$</span>lambda.min), <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>To investigate which variables are important at a <span class="math inline">\(\lambda\)</span> value, we can view the coefficients using the <code>coef</code> function. They are ranked here:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="model.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#coef(ames_lasso, s = ames_lasso_cv$lambda.1se) %&gt;%</span></span>
<span id="cb30-2"><a href="model.html#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  broom::tidy() %&gt;%</span></span>
<span id="cb30-3"><a href="model.html#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  filter(row != &quot;(Intercept)&quot;) %&gt;%</span></span>
<span id="cb30-4"><a href="model.html#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  ggplot(aes(value, reorder(row, value))) +</span></span>
<span id="cb30-5"><a href="model.html#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  geom_point() +</span></span>
<span id="cb30-6"><a href="model.html#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co">#  ggtitle(&quot;Influential Variables&quot;) +</span></span>
<span id="cb30-7"><a href="model.html#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  xlab(&quot;Coefficient&quot;) +</span></span>
<span id="cb30-8"><a href="model.html#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co">#  ylab(NULL)</span></span></code></pre></div>
<p>The variable describing the overall quality of the home is the driving factor of this model as well as the other variables listed above.</p>
<p>A similar approach can be taken for CV with ridge regression using the same structure of code. That will not be covered here. Elastic nets are more complicated in that they have multiple parameters to optimize. For that approach, an optimization grid will need to be structured to evaluate different <span class="math inline">\(\lambda\)</span> values across different <span class="math inline">\(\alpha\)</span> values. A loop can be set up to run the <code>cv.glmnet</code> function across many different values of <span class="math inline">\(\alpha\)</span>. That will not be covered in detail here.</p>
</div>
</div>
<div id="model-comparisons" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Model Comparisons<a href="model.html#model-comparisons" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now we have multiple models built for our dataset. To help evaluate which model is better, we will use the test dataset as described in Chapter <a href="slr.html#slr">2</a>.</p>
<p>The models we have built are nothing but formulas. All we have to do is put the test dataset in the formula to predict/score the test data. We <strong>do not</strong> rerun the algorithm as the goal is <strong>not</strong> to fit the test dataset, but to just score it. We need to make sure that we have the same structure to the test dataset that we do with the training dataset. Any variable transformations, new variable creations, and missing value imputations done on the training dataset must be done on the test dataset in the same way.</p>
<div id="model-metrics" class="section level3 hasAnchor" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> Model Metrics<a href="model.html#model-metrics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Once the predicted values are obtained from each model we need to evaluate good these predictions are. There are many different metrics to evaluate models depending on what type of target variable that you have. Some common metrics for continuous target variables are the square root of the mean squared error (RMSE), the mean absolute error (MAE), and mean absolute percentage error (MAPE).</p>
<p>The RMSE is evaluated as follows:</p>
<p><span class="math display">\[
RMSE = \sqrt {\frac{1}{n} \sum_{i=1}^n (y_i - \hat{y}_i)^2}
\]</span>
The RMSE is an approximation of the standard deviation of the prediction errors of the model. The downside of the RMSE is a lack of interpretability.</p>
<p>The MAE is evaluated as follows:</p>
<p><span class="math display">\[
MAE = \frac{1}{n} \sum_{i=1}^n |y_i - \hat{y}_i|
\]</span>
The MAE gives the average absolute difference between our predictions and the actual values. This is a symmetric measure with great interpretability. The main disadvantage of this metric is that it depends on the scale of the data. For comparing two models evaluated on the same data, this isn’t important. However, when comparing across different datasets, this may not be as helpful. For example, in temperature predictions, having an MAE of five degrees for a model built on Honolulu, Hawaii weather might not be comparable to a model built on weather in Raleigh, North Carolina.</p>
<p>The MAPE is evaluated as follows:</p>
<p><span class="math display">\[
MAPE = 100 \times \frac{1}{n} \sum_{i=1}^n |\frac{y_i - \hat{y}_i}{y_i}|
\]</span>
The MAPE gives the average absolute <em>percentage</em> difference between our predictions and the actual values. This metric is very interpretable and not dependent on the scale of the data. However, it is not symmetric like the MAE.</p>
</div>
<div id="test-dataset-comparison" class="section level3 hasAnchor" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> Test Dataset Comparison<a href="model.html#test-dataset-comparison" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The final model we had from Chapter <a href="diag.html#diag">5</a> had the variables . From this model we can use the <code>predict</code> function with the <code>newdata =</code> option to use score the <code>test</code> dataset.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="model.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#test$pred_lm &lt;- predict(ames_lm, newdata = test)</span></span>
<span id="cb31-2"><a href="model.html#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="model.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">#head(test$pred_lm)</span></span></code></pre></div>
<p>To get predictions from the regularized regression models, a <span class="math inline">\(\lambda\)</span> value must be selected. For the previous LASSO regression we will choose the largest <span class="math inline">\(\lambda\)</span> value within one standard error of the minimum <span class="math inline">\(\lambda\)</span> value to help reduce the number of variables. Again, we will use the <code>predict</code> function. The <code>s =</code> option is where we input the <span class="math inline">\(\lambda\)</span> value. The <code>newx =</code> option is where we specify the <code>test</code> dataset.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="model.html#cb32-1" aria-hidden="true" tabindex="-1"></a>test_reg<span class="sc">$</span>pred_lasso <span class="ot">&lt;-</span> <span class="fu">predict</span>(ames_lasso, <span class="at">s =</span> ames_lasso_cv<span class="sc">$</span>lambda<span class="fl">.1</span>se, <span class="at">newx =</span> test_x)</span>
<span id="cb32-2"><a href="model.html#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="model.html#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(test_reg<span class="sc">$</span>pred_lasso)</span></code></pre></div>
<pre><code>##         s1
## 1 156677.8
## 2 172432.5
## 3 239922.1
## 4 105713.6
## 5 200908.8
## 6 124913.5</code></pre>
<p>Now we need to calculate the MAE and MAPE for each model for comparison.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="model.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#test %&gt;%</span></span>
<span id="cb34-2"><a href="model.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  mutate(lm_APE = 100*abs((Sale_Price - pred_lm)/Sale_Price)) %&gt;%</span></span>
<span id="cb34-3"><a href="model.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  dplyr::summarise(MAPE_lm = mean(lm_APE))</span></span>
<span id="cb34-4"><a href="model.html#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="model.html#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">#test_reg %&gt;%</span></span>
<span id="cb34-6"><a href="model.html#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co">#  mutate(lasso_APE = 100*abs((Sale_Price - pred_lasso)/Sale_Price)) %&gt;%</span></span>
<span id="cb34-7"><a href="model.html#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  dplyr::summarise(MAPE_lasso = mean(lasso_APE))</span></span></code></pre></div>
<p>From the above results, the linear regression from LASSO has a lower MAPE.</p>
<p>Once we have scored models with the test dataset, we should <strong>not</strong> go back to try and rebuild any models. We will use the model with the lowest MAE or MAPE. This number is also the number that we report on how well our model performs. No metrics on the training dataset should be reported for the performance of the model.</p>
</div>
<div id="python-code-27" class="section level3 hasAnchor" number="6.3.3">
<h3><span class="header-section-number">6.3.3</span> Python Code<a href="model.html#python-code-27" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>CV in Regularized Regression</em></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="model.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LassoCV</span>
<span id="cb35-2"><a href="model.html#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="model.html#cb35-3" aria-hidden="true" tabindex="-1"></a>ames_lasso2 <span class="op">=</span> LassoCV(cv <span class="op">=</span> <span class="dv">10</span>, random_state <span class="op">=</span> <span class="dv">0</span>).fit(X, y)</span>
<span id="cb35-4"><a href="model.html#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="model.html#cb35-5" aria-hidden="true" tabindex="-1"></a>ames_lasso2.alpha_</span></code></pre></div>
<pre><code>## 256031.19608623214</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="model.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb37-2"><a href="model.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb37-3"><a href="model.html#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LassoLarsIC</span>
<span id="cb37-4"><a href="model.html#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline</span>
<span id="cb37-5"><a href="model.html#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="model.html#cb37-6" aria-hidden="true" tabindex="-1"></a>start_time <span class="op">=</span> time.time()</span>
<span id="cb37-7"><a href="model.html#cb37-7" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_pipeline(StandardScaler(), LassoCV(cv <span class="op">=</span> <span class="dv">10</span>)).fit(X, y)</span>
<span id="cb37-8"><a href="model.html#cb37-8" aria-hidden="true" tabindex="-1"></a>fit_time <span class="op">=</span> time.time() <span class="op">-</span> start_time</span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="model.html#cb38-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2"><a href="model.html#cb38-2" aria-hidden="true" tabindex="-1"></a>lasso <span class="op">=</span> model[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb38-3"><a href="model.html#cb38-3" aria-hidden="true" tabindex="-1"></a>plt.semilogx(lasso.alphas_, lasso.mse_path_, linestyle<span class="op">=</span><span class="st">&quot;:&quot;</span>)</span>
<span id="cb38-4"><a href="model.html#cb38-4" aria-hidden="true" tabindex="-1"></a>plt.plot(</span>
<span id="cb38-5"><a href="model.html#cb38-5" aria-hidden="true" tabindex="-1"></a>    lasso.alphas_,</span>
<span id="cb38-6"><a href="model.html#cb38-6" aria-hidden="true" tabindex="-1"></a>    lasso.mse_path_.mean(axis<span class="op">=-</span><span class="dv">1</span>),</span>
<span id="cb38-7"><a href="model.html#cb38-7" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">&quot;black&quot;</span>,</span>
<span id="cb38-8"><a href="model.html#cb38-8" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">&quot;Average across the folds&quot;</span>,</span>
<span id="cb38-9"><a href="model.html#cb38-9" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb38-10"><a href="model.html#cb38-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-11"><a href="model.html#cb38-11" aria-hidden="true" tabindex="-1"></a>plt.axvline(lasso.alpha_, linestyle<span class="op">=</span><span class="st">&quot;--&quot;</span>, color<span class="op">=</span><span class="st">&quot;black&quot;</span>, label<span class="op">=</span><span class="st">&quot;alpha: CV estimate&quot;</span>)</span>
<span id="cb38-12"><a href="model.html#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="model.html#cb38-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r&quot;$\alpha$&quot;</span>)</span>
<span id="cb38-14"><a href="model.html#cb38-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Mean square error&quot;</span>)</span>
<span id="cb38-15"><a href="model.html#cb38-15" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb38-16"><a href="model.html#cb38-16" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> plt.title(</span>
<span id="cb38-17"><a href="model.html#cb38-17" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f&quot;Mean square error on each fold: coordinate descent (train time: </span><span class="sc">{</span>fit_time<span class="sc">:.2f}</span><span class="ss">s)&quot;</span></span>
<span id="cb38-18"><a href="model.html#cb38-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-19"><a href="model.html#cb38-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-20"><a href="model.html#cb38-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-25-1.png" width="672" /><img src="bookdownproj_files/figure-html/unnamed-chunk-25-2.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="diag.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="cat.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/IAA-Faculty/statistical_foundations.git/edit/master/06-model_building_scoring.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/IAA-Faculty/statistical_foundations.git/blob/master/06-model_building_scoring.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"toc": null
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
